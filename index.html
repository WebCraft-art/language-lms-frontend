<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AKW Lingua LMS â€” CRM Style</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      },
      plugins: [tailwindcss.forms],
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gray-100">

  <div id="root" class="min-h-screen flex flex-col"></div>

  <script>
    const seedCourses = [
      {
        id: crypto.randomUUID(),
        slug: "angielski-a1",
        language: "en",
        level: "A1",
        price: 199,
        image: "https://source.unsplash.com/600x400/?english,language",
        translations: [
          { lang: "pl", title: "Angielski A1", description: "Podstawowy kurs jÄ™zyka angielskiego" }
        ],
        modules: [
          {
            id: crypto.randomUUID(),
            title: "ModuÅ‚ 1",
            lessons: [
              { id: crypto.randomUUID(), title: "Lekcja 1", content: "Wprowadzenie do alfabetu" },
              { id: crypto.randomUUID(), title: "Lekcja 2", content: "Podstawowe zwroty i liczby" }
            ]
          }
        ]
      }
    ];

    function initStorage() {
      if (!localStorage.getItem("courses")) {
        localStorage.setItem("courses", JSON.stringify(seedCourses));
      }
      if (!localStorage.getItem("users")) {
        localStorage.setItem("users", JSON.stringify([]));
      }
    }

    function getCourses() {
      return JSON.parse(localStorage.getItem("courses") || "[]");
    }
    function getUsers() {
      return JSON.parse(localStorage.getItem("users") || "[]");
    }
    function saveUsers(users) {
      localStorage.setItem("users", JSON.stringify(users));
    }
    function getCurrentUser() {
      const id = localStorage.getItem("currentUserId");
      return getUsers().find(u => u.id === id) || null;
    }
    function setCurrentUser(id) {
      localStorage.setItem("currentUserId", id);
    }
    function logout() {
      localStorage.removeItem("currentUserId");
      render();
    }

    function register(name, email, password) {
      const users = getUsers();
      if (users.find(u => u.email === email)) {
        alert("Email juÅ¼ istnieje.");
        return;
      }
      const newUser = { id: crypto.randomUUID(), name, email, password, role: "student", orders: [], progress: {} };
      users.push(newUser);
      saveUsers(users);
      setCurrentUser(newUser.id);
      render();
    }

    function login(email, password) {
      const user = getUsers().find(u => u.email === email && u.password === password);
      if (!user) return alert("NieprawidÅ‚owe dane logowania.");
      setCurrentUser(user.id);
      render();
    }

    function buyCourse(courseId) {
      const user = getCurrentUser();
      if (!user) return alert("Zaloguj siÄ™.");
      if (!user.orders.includes(courseId)) user.orders.push(courseId);
      saveUsers(getUsers().map(u => u.id === user.id ? user : u));
      render();
    }

    function completeLesson(courseId, lessonId) {
      const user = getCurrentUser();
      if (!user.progress[courseId]) user.progress[courseId] = {};
      user.progress[courseId][lessonId] = true;
      saveUsers(getUsers().map(u => u.id === user.id ? user : u));
      render();
    }

    function progress(course, user) {
      const total = course.modules.reduce((sum, m) => sum + m.lessons.length, 0);
      const done = Object.keys(user.progress[course.id] || {}).length;
      return total ? Math.round((done / total) * 100) : 0;
    }

    function render() {
      const root = document.getElementById("root");
      const user = getCurrentUser();

      root.innerHTML = `
        <div class="flex flex-col md:flex-row h-screen">
          <!-- Sidebar -->
          <aside class="bg-white w-full md:w-64 p-4 border-r">
            <h1 class="text-xl font-bold mb-4">AKW Lingua</h1>
            <nav class="flex flex-col gap-2">
              <button onclick="renderDashboard()" class="text-left text-gray-700 hover:text-blue-600">ğŸ“Š Dashboard</button>
              <button onclick="renderCourses()" class="text-left text-gray-700 hover:text-blue-600">ğŸ“š Kursy</button>
              ${user ? `<button onclick="logout()" class="text-left text-red-600">ğŸšª Wyloguj (${user.name})</button>` : `
                <button onclick="renderLogin()" class="text-left text-gray-700 hover:text-blue-600">ğŸ” Logowanie</button>
                <button onclick="renderRegister()" class="text-left text-gray-700 hover:text-blue-600">ğŸ“ Rejestracja</button>
              `}
            </nav>
          </aside>

          <!-- Main -->
          <main class="flex-1 p-6 overflow-y-auto" id="main"></main>
        </div>
      `;

      renderDashboard();
    }

    function renderDashboard() {
      const user = getCurrentUser();
      const main = document.getElementById("main");
      if (!user) {
        main.innerHTML = `<p class="text-gray-600">Zaloguj siÄ™, aby zobaczyÄ‡ swoje kursy.</p>`;
        return;
      }

      const courses = getCourses().filter(c => user.orders.includes(c.id));
      if (courses.length === 0) {
        main.innerHTML = `<p class="text-gray-600">Nie masz jeszcze Å¼adnych kursÃ³w. PrzejdÅº do zakÅ‚adki <strong>Kursy</strong>.</p>`;
        return;
      }

      main.innerHTML = `
        <h2 class="text-2xl font-semibold mb-4">TwÃ³j Dashboard</h2>
        <div class="grid gap-4 sm:grid-cols-2">
          ${courses.map(c => `
            <div class="bg-white rounded shadow p-4 border">
              <div class="font-semibold text-lg mb-1">${c.translations[0].title}</div>
              <div class="text-sm text-gray-500 mb-2">PostÄ™p: ${progress(c, user)}%</div>
              <div class="w-full bg-gray-200 rounded h-2 mb-3">
                <div class="bg-blue-500 h-2 rounded" style="width:${progress(c, user)}%"></div>
              </div>
              <button onclick="renderCourse('${c.slug}')" class="text-sm text-blue-600 underline">PrzejdÅº do kursu</button>
            </div>
          `).join("")}
        </div>
      `;
    }

    function renderCourses() {
      const courses = getCourses();
      const user = getCurrentUser();
      const main = document.getElementById("main");

      main.innerHTML = `
        <h2 class="text-2xl font-semibold mb-4">DostÄ™pne kursy</h2>
        <div class="grid gap-6 sm:grid-cols-2">
          ${courses.map(c => `
            <div class="bg-white rounded shadow border">
              <img src="${c.image}" alt="" class="rounded-t h-40 w-full object-cover"/>
              <div class="p-4">
                <h3 class="font-semibold text-lg mb-1">${c.translations[0].title}</h3>
                <p class="text-gray-600 text-sm mb-2">${c.translations[0].description}</p>
                <div class="flex justify-between items-center text-sm">
                  <span>${c.level} â€¢ ${c.language.toUpperCase()}</span>
                  <strong>${c.price} PLN</strong>
                </div>
                <button onclick="renderCourse('${c.slug}')" class="mt-3 w-full bg-blue-600 text-white py-1 rounded hover:bg-blue-700">Zobacz</button>
              </div>
            </div>
          `).join("")}
        </div>
      `;
    }

    function renderCourse(slug) {
      const course = getCourses().find(c => c.slug === slug);
      const user = getCurrentUser();
      const bought = user?.orders.includes(course.id);
      const main = document.getElementById("main");

      main.innerHTML = `
        <button onclick="renderCourses()" class="text-sm mb-4 text-blue-600 underline">â† PowrÃ³t</button>
        <h2 class="text-2xl font-semibold mb-1">${course.translations[0].title}</h2>
        <p class="text-gray-600 mb-4">${course.translations[0].description}</p>
        ${bought ? `<div class="text-green-600 font-medium mb-4">âœ… Kurs zakupiony</div>` :
        `<button onclick="buyCourse('${course.id}')" class="bg-green-600 text-white px-4 py-2 rounded mb-4 hover:bg-green-700">Kup za ${course.price} PLN</button>`}
        ${course.modules.map(m => `
          <div class="mb-4">
            <h3 class="font-semibold">${m.title}</h3>
            <ul class="list-disc pl-5 mt-2 text-sm">
              ${m.lessons.map(l => `
                <li>
                  ${bought
                    ? `<button onclick="renderLesson('${course.id}', '${l.id}')" class="text-blue-600 underline">${l.title}</button>
                       ${user?.progress?.[course.id]?.[l.id] ? "âœ…" : ""}`
                    : `<span class="text-gray-500">${l.title}</span>`}
                </li>
              `).join("")}
            </ul>
          </div>
        `).join("")}
      `;
    }

    function renderLesson(courseId, lessonId) {
      const course = getCourses().find(c => c.id === courseId);
      const lesson = course.modules.flatMap(m => m.lessons).find(l => l.id === lessonId);
      const main = document.getElementById("main");

      main.innerHTML = `
        <button onclick="renderCourse('${course.slug}')" class="text-sm mb-4 text-blue-600 underline">â† PowrÃ³t</button>
        <h2 class="text-xl font-semibold mb-2">${lesson.title}</h2>
        <p class="mb-4 text-gray-700">${lesson.content}</p>
        <button onclick="completeLesson('${course.id}', '${lesson.id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Oznacz jako ukoÅ„czonÄ…</button>
      `;
    }

    function renderLogin() {
      const main = document.getElementById("main");
      main.innerHTML = `
        <h2 class="text-2xl font-semibold mb-4">Logowanie</h2>
        <form onsubmit="handleLogin(event)" class="space-y-4 max-w-sm">
          <input required name="email" type="email" class="w-full border p-2 rounded" placeholder="Email">
          <input required name="password" type="password" class="w-full border p-2 rounded" placeholder="HasÅ‚o">
          <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Zaloguj siÄ™</button>
        </form>
      `;
    }

    function handleLogin(e) {
      e.preventDefault();
      const f = e.target;
      login(f.email.value, f.password.value);
    }

    function renderRegister() {
      const main = document.getElementById("main");
      main.innerHTML = `
        <h2 class="text-2xl font-semibold mb-4">Rejestracja</h2>
        <form onsubmit="handleRegister(event)" class="space-y-4 max-w-sm">
          <input required name="name" class="w-full border p-2 rounded" placeholder="ImiÄ™">
          <input required name="email" type="email" class="w-full border p-2 rounded" placeholder="Email">
          <input required name="password" type="password" class="w-full border p-2 rounded" placeholder="HasÅ‚o">
          <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Zarejestruj siÄ™</button>
        </form>
      `;
    }

    function handleRegister(e) {
      e.preventDefault();
      const f = e.target;
      register(f.name.value, f.email.value, f.password.value);
    }

    // Init
    initStorage();
    render();
  </script>
</body>
</html>
